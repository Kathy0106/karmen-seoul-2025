<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–çˆ¾è–èª•è‡ªç”±è¡Œ - è¡Œç¨‹ç®¡ç†</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Zen Maru Gothic å­—é«” (æ—¥å¼å¯æ„›é¢¨æ ¼) -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* è‡ªå®šç¾©å­—é«”å’Œè–èª•è‰²å½©é…ç½® */
        :root {
            --christmas-green: #15803d; /* ä¸»è‰²ï¼šæ·±è–èª•ç¶  (Emerald 700) */
            --christmas-red: #b91c1c; /* å¼·èª¿è‰²ï¼šå–œæ…¶ç´… (Red 700) */
            --snow-white: #FFFFFF; /* é›ªç™½ */
            --warm-gray: #B2B2B2; /* æš–ç° */
            --bg-color: #fcfcfc; /* è¼•å¾®çš„èƒŒæ™¯è‰² */
        }
        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            padding-top: 5rem; 
            padding-bottom: 5rem;
        }
        .main-container {
            max-width: 420px;
            margin: auto;
            min-height: 100vh;
            background-color: var(--snow-white);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        .nav-active {
            color: var(--christmas-red);
            border-top: 2px solid var(--christmas-red);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* è–èª•ä¸»é¡Œçš„è¼¸å…¥æ¡†ç„¦é»æ•ˆæœ */
        input:focus, select:focus, textarea:focus {
            border-color: var(--christmas-red) !important;
            box-shadow: 0 0 0 1px var(--christmas-red) !important;
        }

        /* Tailwind Config for custom colors */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-green': 'var(--christmas-green)',
                        'main-red': 'var(--christmas-red)',
                        'snow-white': 'var(--snow-white)',
                        'warm-gray': 'var(--warm-gray)',
                        'bg-color': 'var(--bg-color)',
                        // è–èª•è¼”åŠ©è‰²
                        'accent-gold': '#FACC15', // é»ƒé‡‘è‰²
                        'accent-food': '#B91C1C', // ç´…è‰² (é¤é£²)
                        'accent-shop': '#D97706', // æ©˜é‡‘è‰² (è³¼ç‰©)
                        'accent-sight': '#34D399', // è–„è·ç¶  (æ™¯é»)
                    }
                }
            }
        }
    </style>
</head>
<body>

    <!-- App Main Container (æ¨¡æ“¬æ‰‹æ©Ÿè¢å¹•) -->
    <div class="main-container relative">

        <!-- Header (å›ºå®šåœ¨é ‚éƒ¨) -->
        <header class="fixed top-0 w-full max-w-[420px] bg-main-green text-snow-white p-4 z-10 shadow-lg rounded-b-2xl">
            <h1 class="text-xl font-bold text-center flex items-center justify-center">
                <i data-lucide="sparkles" class="w-5 h-5 mr-2 text-accent-gold"></i>
                é¦–çˆ¾è–èª•è‡ªç”±è¡Œ
            </h1>
            <p class="text-sm text-center opacity-90 mt-1">ğŸ„ 2025/12/25 - 12/29</p>
        </header>

        <!-- Main Content -->
        <main id="app-content" class="p-4 pt-4 pb-20">
            <!-- å…§å®¹å°‡ç”± JavaScript è¼‰å…¥ -->
        </main>

        <!-- Bottom Floating Navigation Bar (Tabs) -->
        <nav class="fixed bottom-0 w-full max-w-[420px] bg-snow-white shadow-[0_-4px_10px_rgba(0,0,0,0.1)] z-20 rounded-t-2xl">
            <div class="flex justify-around items-center h-16">
                <button class="nav-item flex flex-col items-center justify-center h-full w-1/4 text-warm-gray transition-colors nav-active" data-tab="itinerary">
                    <i data-lucide="calendar-days" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">è¡Œç¨‹</span>
                </button>
                <button class="nav-item flex flex-col items-center justify-center h-full w-1/4 text-warm-gray transition-colors" data-tab="guide">
                    <i data-lucide="map" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">æŒ‡å—</span>
                </button>
                <button class="nav-item flex flex-col items-center justify-center h-full w-1/4 text-warm-gray transition-colors" data-tab="weather">
                    <i data-lucide="cloud-lightning" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">å¤©æ°£</span>
                </button>
                <button class="nav-item flex flex-col items-center justify-center h-full w-1/4 text-warm-gray transition-colors" data-tab="finance">
                    <i data-lucide="wallet" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">æ¶ˆè²»</span>
                </button>
            </div>
        </nav>
    </div>

    <script>
        // --- å…¨å±€ç‹€æ…‹ç®¡ç† ---
        let currentDayIndex = 0; 
        let editingSpotId = null; // å„²å­˜ç•¶å‰æ­£åœ¨ç·¨è¼¯çš„æ™¯é» ID
        let isAddingSpot = false; // æ¨™è¨˜æ˜¯å¦æ­£åœ¨æ–°å¢æ™¯é»

        // è²¡å‹™ç‹€æ…‹ (æ¨¡æ“¬è³‡æ–™)
        let financeState = {
            baseCurrency: 'HKD',
            targetCurrency: 'KRW',
            rate: 170.5, 
            lastUpdated: new Date().toLocaleTimeString('zh-Hant', { hour: '2-digit', minute: '2-digit' }),
            exchangeStatus: 'æˆåŠŸé€£ç·š',
            budget: 5000, 
            expenses: [
                { id: 1, day: 1, item: 'æ—©é¤: Dotori Garden', amountKRW: 34000, amountHKD: 199.4, category: 'é¤é£²' },
                { id: 2, day: 1, item: 'äº¤é€š: åœ°éµ/å·´å£«', amountKRW: 4000, amountHKD: 23.5, category: 'äº¤é€š' },
                { id: 3, day: 2, item: 'è³¼ç‰©: æ˜æ´è­·è†šå“', amountKRW: 120000, amountHKD: 703.8, category: 'è³¼ç‰©' },
            ],
        };

        // è¡Œç¨‹æ•¸æ“š (ä½¿ç”¨ let å…è¨±ç·¨è¼¯å’Œæ–°å¢)
        let itineraryData = [
            {
                id: 101, day: 1, date: "12/25 (Day 1)", route: "å®‰åœ‹ â†’ å¼˜å¤§ â†’ å»¶å—æ´ â†’ æ˜æ´ç‡ˆé£¾", location: "é¦–çˆ¾åŒ—éƒ¨",
                attire: "å»ºè­°ç©¿è‘—ï¼šç¾½çµ¨å¤–å¥—ã€åšæ¯›è¡£ã€åœå·¾ã€ä¿æš–å…§æ­ã€‚æˆ¶å¤–æ´»å‹•å¤šï¼Œéœ€æ³¨æ„ä¿æš–ã€‚",
                snow: "â„ï¸ é›ªæ³æç¤ºï¼šè–èª•ç¯€ç•¶æ—¥æœ‰é™£é›ªæ©Ÿç‡ï¼Œåœ°é¢å¯èƒ½æ¿•æ»‘ï¼Œè«‹ç©¿è‘—é˜²æ»‘é´ã€‚",
                spots: [
                    { id: 1, category: "food", name: "Dotori Garden (ë„í† ë¦¬ê°€ë“ )", desc: "å¯æ„›çš„æ¾é¼ ä¸»é¡Œå’–å•¡å»³ï¼Œæ‹›ç‰Œæ˜¯è»Ÿç¶¿ç¶¿çš„å„ªæ ¼ï¼Œå¿…æ‹æ‰“å¡ï¼", address: "ì„œìš¸ ì¢…ë¡œêµ¬ ë¶ì´Œë¡œ 4ê¸¸ 20", tags: ["å¿…åƒ", "æ‰“å¡"], tip: "å»ºè­°åœ¨æˆ¶å¤–åº­é™¢å€æ‹ç…§ï¼Œå…‰ç·šæœ€ä½³ã€‚" },
                    { id: 2, category: "shopping", name: "å®‰åœ‹é€›è¡—é †è·¯", desc: "å®‰åœ‹ç«™å‘¨é‚Šçš„è¨­è¨ˆå¸«é¸å“åº—é€£ç·šã€‚", address: "ZERO SPACE ì„œìš¸ ì¢…ë¡œêµ¬ ë¶ì´Œë¡œ5ê°€ê¸¸ 16", tags: ["å¿…è²·"], tip: null },
                    { id: 3, category: "transport", name: "å®‰åœ‹ â†’ å¼˜å¤§", desc: "åœ°éµ18åˆ†é˜", address: "å¼˜å¤§å…¥å£ç«™", tags: [], tip: null },
                    { id: 4, category: "food", name: "Gop Mapo çƒ¤è‚¥è…¸ (ê³±ë§ˆí¬)", desc: "åœ°é“çƒ¤è‚¥è…¸ååº—ï¼Œå£æ„ŸQå½ˆã€‚", address: "ì„œìš¸ ë§ˆí¬êµ¬ ë…ë§‰ë¡œ7ê¸¸ 51", tags: ["å¿…åƒ", "åœ°é“"], tip: "é»ä¸€ä»½ç‚’é£¯ä½œç‚ºçµå°¾æ˜¯æ¨™æº–åƒæ³•ï¼" },
                    { id: 5, category: "sightseeing", name: "ğŸ„ æ˜æ´è–èª•ç‡ˆé£¾ - æ˜æ´è–å ‚", desc: "è–èª•ç¯€ç•¶æ—¥ï¼Œæ˜æ´è–å ‚å‘¨é‚Šçš„ç‡ˆé£¾ä½ˆç½®éå¸¸æµªæ¼«ã€‚", address: "ëª…ë™ì„±ë‹¹ ì„œìš¸ ì¤‘êµ¬ ëª…ë™ê¸¸ 74", tags: ["å¿…æ‹", "æ´»å‹•"], tip: "æ™šä¸Š 7-9 é»ç‡ˆå…‰æ•ˆæœæœ€ä½³ã€‚" },
                ]
            },
            {
                id: 102, day: 2, date: "12/26 (Day 2)", route: "æ˜æ´ â†’ å—å¤§é–€ â†’ æ±å¤§é–€ â†’ æ–°å ‚", location: "é¦–çˆ¾å¸‚ä¸­å¿ƒ",
                attire: "å»ºè­°ç©¿è‘—ï¼šä¿æš–å…§æ­+è¼•è–„ç™¼ç†±è¡£ï¼Œå®¤å…§å•†å ´å¤šï¼Œæ´‹è”¥å¼ç©¿æ­ç‚ºä¸»ã€‚",
                snow: "â˜€ï¸ é›ªæ³æç¤ºï¼šä»Šæ—¥æ™´æœ—ï¼Œæˆ¶å¤–é«”æ„Ÿæº«åº¦è¼ƒä½ï¼Œä½†æ²’æœ‰ç©é›ªå›°æ“¾ã€‚",
                spots: [
                    { id: 6, category: "food", name: "å®‹å®¶é£¯æ² (ì†¡ê°€ê¹€ë°¥)", desc: "æ˜æ´å‚³çµ±éŸ“å¼é£¯æ²ï¼Œç°¡å–®åˆç¾å‘³çš„æ—©é¤é¸æ“‡ã€‚", address: "ì„œìš¸ ì¤‘êµ¬ í‡´ê³„ë¡œ 120", tags: ["æ—©é¤", "å°åƒ"], tip: null },
                    { id: 7, category: "shopping", name: "å—å¤§é–€å¸‚å ´ (ë‚¨ëŒ€ë¬¸ì‹œì¥)", desc: "éŸ“åœ‹æ­·å²æœ€æ‚ ä¹…çš„å‚³çµ±å¸‚å ´ï¼Œè—¥å¦ã€ç«¥è£ã€ç‰¹ç”¢è£œè²¨ç«™ã€‚", address: "ì„œìš¸ ì¤‘êµ¬ ë‚¨ëŒ€ë¬¸ì‹œì¥4ê¸¸ 21", tags: ["å¿…è²·", "å‚³çµ±"], tip: "å¸‚å ´å…§å¾ˆå¤šå°åƒæ”¤ï¼Œå¯ä»¥é‚Šèµ°é‚Šåƒã€‚" },
                    { id: 8, category: "food", name: "ğŸ”¥ å‹èª¼è¾£é›çˆª (ìš°ì •ë‹­ë°œ)", desc: "æ–°å ‚è¾£é›çˆªä¸€æ¢è¡—çš„äººæ°£åº—ï¼Œç„¡éª¨è¾£é›çˆªé…ç‡’é…’ã€‚", address: "ì„œìš¸ ì¤‘êµ¬ í‡´ê³„ë¡œ 421 (æ–°å ‚ ë‹­ë°œ ê³¨ëª©)", tags: ["æ™šé¤", "åœ°é“"], tip: "è¾£åº¦å¯ä»¥èª¿æ•´ï¼Œå»ºè­°å¾å…¥é–€ç´šé–‹å§‹å˜—è©¦ã€‚" },
                ]
            },
            // ç”±æ–¼åªæä¾› 2 å¤©æ•¸æ“šï¼Œæˆ‘å€‘è¤‡è£½ Day 1, 2, 5 æ•¸æ“šä¾†æ¨¡æ“¬ 5 å¤©åˆ‡æ›
            { id: 103, day: 3, date: "12/27 (Day 3)", route: "æ™¯ç¦å®® â†’ ä¸‰æ¸…æ´", location: "é¦–çˆ¾åŒ—éƒ¨",
                attire: "å»ºè­°ç©¿è‘—ï¼šæœ€å¼·ç¦¦å¯’è£å‚™ï¼Œæœ¬æ—¥å¤šç‚ºæˆ¶å¤–æ´»å‹•ã€‚", snow: "â˜€ï¸ é›ªæ³æç¤ºï¼šæ™´æœ—ï¼Œä½†é¢¨å¤§ã€‚", spots: [
                    { id: 9, category: "sightseeing", name: "æ™¯ç¦å®® (ê²½ë³µê¶)", desc: "æœé®®ç‹æœçš„æ­£å®®ï¼Œå¯ä»¥ç§Ÿå€ŸéŸ“æœæ‹ç…§ã€‚", address: "ì„œìš¸ ì¢…ë¡œêµ¬ ì‚¬ì§ë¡œ 161", tags: ["å¿…æ‹", "æ­·å²"], tip: "éŸ“æœå¯å…è²»å…¥å ´ã€‚" },
                    { id: 10, category: "food", name: "åœŸä¿—æ‘è”˜é›æ¹¯ (í† ì†ì´Œ ì‚¼ê³„íƒ•)", desc: "ç¸½çµ±ä¹Ÿæ„›åƒçš„è”˜é›æ¹¯ååº—ã€‚", address: "ì„œìš¸ ì¢…ë¡œêµ¬ ì²´ë¶€ë™ 85-1", tags: ["åˆé¤", "é¤Šç”Ÿ"], tip: null },
                ]
            },
            { id: 104, day: 4, date: "12/28 (Day 4)", route: "æ±Ÿé™µä¸€æ—¥éŠ", location: "æ±ŸåŸé“",
                attire: "å»ºè­°ç©¿è‘—ï¼šç‰¹åšä¿æš–è¡£ç‰©ï¼Œæ±ŸåŸé“æ°£æº«æ›´ä½ã€‚", snow: "â„ï¸ é›ªæ³æç¤ºï¼šæ±Ÿé™µåœ°å€å¯èƒ½æœ‰é›ªã€‚", spots: [
                    { id: 11, category: "activity", name: "æ±Ÿé™µå’–å•¡è¡—", desc: "æ²¿æµ·çš„å’–å•¡å»³ï¼Œæ¬£è³å†¬å­£æµ·æ™¯ã€‚", address: "ê°•ì› ê°•ë¦‰ì‹œ ì°½í•´ë¡œ 17", tags: ["æ‰“å¡", "æµ·æ™¯"], tip: null },
                ]
            },
            {
                id: 105, day: 5, date: "12/29 (Day 5)", route: "æœ€å¾Œè£œè²¨ â†’ ä»å·æ©Ÿå ´", location: "æ©Ÿå ´æº–å‚™",
                attire: "å»ºè­°ç©¿è‘—ï¼šæœ€åšçš„è¡£ç‰©ã€‚æ—©ä¸Šéœ€åœ¨æˆ¶å¤–ç§»å‹•ï¼Œä¸”æ­æ©Ÿæ™‚ä¿æš–é‡è¦ã€‚",
                snow: "â˜€ï¸ é›ªæ³æç¤ºï¼šæ—…ç¨‹çš„æœ€å¾Œä¸€å¤©ï¼Œæ™´ç©ºè¬é‡Œï¼Œé©åˆç§»å‹•ã€‚",
                spots: [
                    { id: 12, category: "food", name: "Egg Drop (ì—ê·¸ë“œë)", desc: "äººæ°£åå¸æ—©é¤åº—ï¼Œè»Ÿå«©æ»‘è›‹æ­é…å¤šç¨®é¤¡æ–™ã€‚", address: "ì„œìš¸ ì¤‘êµ¬ ëª…ë™ê¸¸ 24", tags: ["æ—©é¤", "é€Ÿé£Ÿ"], tip: "æ¨è–¦åŸ¹æ ¹èŠå£«è›‹åå¸ã€‚" },
                    { id: 13, category: "food", name: "æœ€å¾Œåˆé¤ - è±å·é°»é­š (í’ì²œì¥ì–´)", desc: "çƒ¤é°»é­šæ–™ç†ï¼Œä»¥å¥åº·ç¾å‘³ç‚ºæ—…ç¨‹åŠƒä¸‹å®Œç¾å¥é»ã€‚", address: "ì„œìš¸ ì¤‘êµ¬ ëª…ë™4ê¸¸ 10", tags: ["åˆé¤", "é¤Šç”Ÿ"], tip: "é…ä¸Šè–‘çµ²å’Œç‰¹è£½é†¬æ±é£Ÿç”¨ã€‚" },
                    { id: 14, category: "transport", name: "âœˆï¸ é£¯å¾Œ â†’ å›é…’åº—æ‹è¡Œæ â†’ æ©Ÿå ´", desc: "é ç•™å……è¶³æ™‚é–“å‰å¾€æ©Ÿå ´ã€‚", address: "ä»å·åœ‹éš›æ©Ÿå ´", tags: ["äº¤é€š", "å›ç¨‹"], tip: "è«‹æå‰åœ¨ App å…§ç¢ºèªæ©Ÿå ´å¿«ç·šæˆ–å·´å£«çš„æ™‚åˆ»è¡¨ã€‚" },
                ]
            }
        ];
        
        // --- è¼”åŠ©å‡½æ•¸ ---

        /**
         * æ¨¡æ“¬ API å‘¼å«ï¼šå³æ™‚åŒ¯ç‡
         */
        async function fetchExchangeRate() {
            await new Promise(resolve => setTimeout(resolve, 800)); 
            const newRate = (170 + Math.random() * 2).toFixed(2);
            financeState.rate = parseFloat(newRate);
            financeState.lastUpdated = new Date().toLocaleTimeString('zh-Hant', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            financeState.exchangeStatus = 'æˆåŠŸé€£ç·š';
            if (document.querySelector('[data-tab="finance"]').classList.contains('nav-active')) {
                renderFinance();
            }
        }

        /**
         * æ¨¡æ“¬ API å‘¼å«ï¼šèˆªç­ç‹€æ…‹
         */
        async function fetchFlightStatus() {
            await new Promise(resolve => setTimeout(resolve, 1000)); 
            return [
                { code: 'UO626', route: 'é¦™æ¸¯ (HKG) â†’ é¦–çˆ¾ä»å· (ICN)', scheduled: '12/25 08:00', estimated: '12/25 08:05', status: 'æº–æ™‚', icon: 'plane-takeoff', color: 'text-main-green' },
                { code: 'UO631', route: 'é¦–çˆ¾ä»å· (ICN) â†’ é¦™æ¸¯ (HKG)', scheduled: '12/29 19:30', estimated: '12/29 19:30', status: 'æº–æ™‚', icon: 'plane-landing', color: 'text-main-red' },
            ];
        }

        // --- è¡Œç¨‹ç·¨è¼¯/æ–°å¢ (CRUD) é‚è¼¯ ---

        function getCategoryIcon(category) {
            const icons = {
                food: { icon: 'utensils', color: 'bg-accent-food' },
                shopping: { icon: 'shopping-bag', color: 'bg-accent-shop' },
                sightseeing: { icon: 'camera', color: 'bg-accent-sight' },
                activity: { icon: 'ticket', color: 'bg-main-red' },
                transport: { icon: 'car', color: 'bg-main-green' },
                default: { icon: 'map-pin', color: 'bg-warm-gray' }
            };
            return icons[category] || icons.default;
        }

        function getTags(spot) {
            // å˜—è©¦å¾ tags é™£åˆ—æˆ– desc ä¸­æå–ï¼Œæ­¤è™•ç‚ºç°¡åŒ–ç‰ˆ
            return (spot.tags || []).join(', ');
        }

        function startEdit(spotId) {
            editingSpotId = spotId;
            isAddingSpot = false; // ç¢ºä¿æ–°å¢è¡¨å–®é—œé–‰
            renderItinerary();
        }

        function cancelEdit() {
            editingSpotId = null;
            isAddingSpot = false;
            renderItinerary();
        }
        
        function handleDeleteSpot(spotId) {
            if (!confirm('ç¢ºèªè¦åˆªé™¤æ­¤è¡Œç¨‹é …ç›®å—ï¼Ÿ')) return;

            const dayData = itineraryData[currentDayIndex];
            dayData.spots = dayData.spots.filter(spot => spot.id !== spotId);
            renderItinerary();
        }

        function handleSaveSpot(event, spotId) {
            event.preventDefault();
            const form = event.target;
            
            const newSpotData = {
                id: spotId || Date.now(), // æ–°å¢æ™‚ä½¿ç”¨æ–°çš„ ID
                category: form.elements['edit-category'].value,
                name: form.elements['edit-name'].value,
                desc: form.elements['edit-desc'].value,
                address: form.elements['edit-address'].value,
                tags: form.elements['edit-tags'].value.split(',').map(tag => tag.trim()).filter(tag => tag),
                tip: form.elements['edit-tip'].value || null,
            };

            const dayData = itineraryData[currentDayIndex];

            if (spotId) {
                // ç·¨è¼¯ç¾æœ‰é …ç›®
                const index = dayData.spots.findIndex(spot => spot.id === spotId);
                if (index !== -1) {
                    dayData.spots[index] = newSpotData;
                    editingSpotId = null;
                }
            } else {
                // æ–°å¢é …ç›®
                dayData.spots.push(newSpotData);
                isAddingSpot = false;
            }
            
            renderItinerary();
        }

        // --- æ¸²æŸ“å‡½æ•¸ï¼šè¡Œç¨‹é  (Itinerary) ---
        
        /**
         * æ¸²æŸ“å–®å€‹æ™¯é»å¡ç‰‡ (åŒ…å«ç·¨è¼¯æ¨¡å¼)
         */
        function renderSpotCard(spot) {
            if (editingSpotId === spot.id) {
                // ç·¨è¼¯æ¨¡å¼ï¼šæ¸²æŸ“è¡¨å–®
                return renderSpotEditForm(spot);
            }

            // é¡¯ç¤ºæ¨¡å¼ï¼šæ¸²æŸ“å¡ç‰‡
            const { icon, color } = getCategoryIcon(spot.category);
            const tagElements = (spot.tags || []).map(tag => {
                let tagColor = 'bg-warm-gray';
                if (tag === 'å¿…åƒ' || tag === 'æ—©é¤' || tag === 'æ™šé¤') tagColor = 'bg-accent-food';
                else if (tag === 'å¿…è²·' || tag === 'æ½®æµ' || tag === 'è£œè²¨') tagColor = 'bg-accent-shop';
                else if (tag === 'å¿…æ‹' || tag === 'æ‰“å¡' || tag === 'æ´»å‹•') tagColor = 'bg-accent-sight';

                return `<span class="text-xs font-medium px-2 py-0.5 rounded-full text-snow-white ${tagColor}">${tag}</span>`;
            }).join('');

            const naverMapsUrl = spot.address ? `https://map.naver.com/p/search/${encodeURIComponent(spot.address)}` : '#';
            const navButtonHtml = spot.address && spot.category !== 'transport' ? `
                <a href="${naverMapsUrl}" target="_blank" class="flex items-center text-xs font-semibold text-main-green hover:text-green-700 transition-colors">
                    <i data-lucide="map" class="w-4 h-4 mr-1"></i> Naver åœ°åœ–å°èˆª
                </a>
            ` : '';

            const tipHtml = spot.tip ? `
                <div class="bg-accent-gold/20 p-3 mt-3 rounded-xl border border-accent-gold/40">
                    <p class="font-bold text-gray-800 text-sm mb-1 flex items-center"><i data-lucide="sparkles" class="w-4 h-4 mr-1 text-accent-shop"></i> å°è²¼å£«</p>
                    <p class="text-xs text-gray-700">${spot.tip}</p>
                </div>
            ` : '';

            return `
                <div class="spot-card bg-snow-white p-4 mb-4 rounded-xl shadow-lg transition-all border-l-4 border-main-red/50">
                    <div class="flex items-start justify-between">
                        <div class="flex items-center">
                            <span class="p-2 rounded-full ${color} text-snow-white mr-3 shadow-md">
                                <i data-lucide="${icon}" class="w-5 h-5"></i>
                            </span>
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">${spot.name}</h3>
                                <div class="flex flex-wrap gap-1 mt-1">${tagElements}</div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="startEdit(${spot.id})" class="text-main-green hover:text-green-700 transition-colors p-1 rounded-full bg-main-green/10">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="handleDeleteSpot(${spot.id})" class="text-main-red hover:text-red-700 transition-colors p-1 rounded-full bg-main-red/10">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mt-3">${spot.desc}</p>
                    
                    ${spot.address ? `<p class="text-xs text-gray-500 mt-2 flex items-center"><i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> ${spot.address}</p>` : ''}

                    ${tipHtml}

                    <div class="flex justify-end items-center mt-3 pt-3 border-t border-warm-gray/30">
                        ${navButtonHtml || '<span></span>'}
                    </div>
                </div>
            `;
        }

        /**
         * æ¸²æŸ“æ™¯é»ç·¨è¼¯è¡¨å–®
         */
        function renderSpotEditForm(spot) {
            const isNew = !spot.id;
            const title = isNew ? 'æ–°å¢è¡Œç¨‹é …ç›®' : 'ç·¨è¼¯è¡Œç¨‹é …ç›®';
            const categories = ['food', 'shopping', 'sightseeing', 'activity', 'transport', 'default'];

            return `
                <form onsubmit="handleSaveSpot(event, ${spot.id || ''})" class="bg-main-green/10 p-4 mb-4 rounded-xl shadow-inner border border-main-green/30">
                    <h3 class="text-lg font-bold text-main-green mb-3">${title}</h3>
                    <div class="space-y-2">
                        <!-- åç¨± -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">åç¨±/æ¨™é¡Œ</label>
                            <input type="text" name="edit-name" value="${spot.name || ''}" required class="w-full p-2 border rounded-lg">
                        </div>
                        <!-- åˆ†é¡ -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">åˆ†é¡</label>
                            <select name="edit-category" class="w-full p-2 border rounded-lg">
                                ${categories.map(cat => `<option value="${cat}" ${spot.category === cat ? 'selected' : ''}>${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`).join('')}
                            </select>
                        </div>
                        <!-- æè¿° -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">æè¿°</label>
                            <textarea name="edit-desc" class="w-full p-2 border rounded-lg">${spot.desc || ''}</textarea>
                        </div>
                        <!-- åœ°å€/åœ°é» -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">åœ°å€ (Naver Map é—œéµå­—)</label>
                            <input type="text" name="edit-address" value="${spot.address || ''}" class="w-full p-2 border rounded-lg">
                        </div>
                        <!-- æ¨™ç±¤ -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">æ¨™ç±¤ (ä»¥é€—è™Ÿåˆ†éš”ï¼Œå¦‚: å¿…åƒ, æ‰“å¡)</label>
                            <input type="text" name="edit-tags" value="${getTags(spot)}" class="w-full p-2 border rounded-lg">
                        </div>
                        <!-- å°è²¼å£« -->
                        <div>
                            <label class="text-xs font-semibold text-gray-700 block mb-1">å°è²¼å£«/å‚™è¨»</label>
                            <input type="text" name="edit-tip" value="${spot.tip || ''}" class="w-full p-2 border rounded-lg">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-2 mt-4">
                        <button type="button" onclick="cancelEdit()" class="px-4 py-2 text-sm font-bold text-gray-700 bg-warm-gray/30 rounded-lg hover:bg-warm-gray/50 transition-colors">å–æ¶ˆ</button>
                        <button type="submit" class="px-4 py-2 text-sm font-bold text-snow-white bg-main-red rounded-lg hover:bg-main-red/90 transition-colors">å„²å­˜</button>
                    </div>
                </form>
            `;
        }
        
        /**
         * æ¸²æŸ“æ–°å¢æ™¯é»çš„æŒ‰éˆ•/è¡¨å–®
         */
        function renderAddSpotToggle() {
            if (isAddingSpot) {
                // æ¸²æŸ“æ–°å¢è¡¨å–®
                return renderSpotEditForm({ category: 'sightseeing', tags: ['æ–°å¢'] });
            } else {
                // æ¸²æŸ“æ–°å¢æŒ‰éˆ•
                return `
                    <button onclick="isAddingSpot = true; editingSpotId = null; renderItinerary();" class="w-full py-3 mt-4 mb-8 bg-main-red text-snow-white rounded-xl font-bold hover:bg-main-red/90 transition-colors shadow-md flex items-center justify-center">
                        <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i> æ–°å¢è¡Œç¨‹é …ç›®
                    </button>
                `;
            }
        }


        function renderItinerary() {
            const data = itineraryData[currentDayIndex];

            // 1. æ¸²æŸ“é ‚éƒ¨æ—¥æœŸåˆ‡æ›
            const daySelectors = itineraryData.map((d, index) => {
                const dayDisplay = index + 1;
                const dateString = itineraryData[index].date.split(' ')[0];
                return `
                    <button 
                        class="day-select-btn flex-shrink-0 px-3 py-1 text-sm font-semibold rounded-full transition-all duration-300 ${index === currentDayIndex ? 'bg-main-red text-snow-white shadow-lg' : 'bg-warm-gray/20 text-gray-700 hover:bg-warm-gray/40'}"
                        data-day-index="${index}"
                    >
                        ${dateString} (Day ${dayDisplay})
                    </button>
                `;
            }).join('');

            const headerHtml = `
                <div class="mb-4 sticky top-[4.5rem] bg-bg-color p-2 rounded-xl shadow-inner z-10">
                    <div class="flex overflow-x-auto space-x-2 pb-1 scrollbar-hide">
                        ${daySelectors}
                    </div>
                </div>
                <h2 class="text-xl font-extrabold text-main-green mb-4 flex items-center p-2 rounded-lg bg-main-green/10">
                    <i data-lucide="star" class="w-5 h-5 mr-2 text-accent-gold"></i> Day ${currentDayIndex + 1}: ${data.route}
                </h2>
            `;

            // 2. æ¸²æŸ“æ¯æ—¥æ™¯é»å¡ç‰‡
            const spotCardsHtml = data.spots.map(renderSpotCard).join('');

            // 3. æ¸²æŸ“èƒŒæ™¯è³‡è¨Š (ç©¿è‘—/é›ªæ³)
            const backgroundInfoHtml = `
                <div class="mt-8 p-4 bg-main-red/10 rounded-2xl border border-main-red/20">
                    <p class="font-bold text-main-green text-base mb-2 flex items-center"><i data-lucide="shirt" class="w-4 h-4 mr-2"></i> å»ºè­°ç©¿è‘—</p>
                    <p class="text-sm text-gray-800">${data.attire}</p>
                    <div class="mt-3 pt-3 border-t border-main-green/30">
                        <p class="font-bold text-main-green text-base mb-1 flex items-center"><i data-lucide="snowflake" class="w-4 h-4 mr-2"></i> é›ªæ³æç¤º</p>
                        <p class="text-sm text-gray-800">${data.snow}</p>
                    </div>
                </div>
            `;


            document.getElementById('app-content').innerHTML = `
                ${headerHtml}
                <div id="itinerary-cards-container">
                    ${spotCardsHtml || '<p class="text-center text-warm-gray mt-8 py-4 bg-gray-50 rounded-xl">æœ¬å¤©è¡Œç¨‹å°šæœªè¦åŠƒï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ–°å¢ã€‚</p>'}
                </div>
                ${renderAddSpotToggle()}
                ${backgroundInfoHtml}
            `;

            // é‡æ–°è¼‰å…¥ Lucide åœ–æ¨™
            lucide.createIcons();
            
            // ç¶å®šæ—¥æœŸåˆ‡æ›äº‹ä»¶
            document.querySelectorAll('.day-select-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const newIndex = parseInt(e.currentTarget.dataset.dayIndex);
                    if (newIndex !== currentDayIndex) {
                        currentDayIndex = newIndex;
                        editingSpotId = null; // åˆ‡æ›æ—¥æœŸæ™‚é—œé–‰ç·¨è¼¯
                        isAddingSpot = false; // åˆ‡æ›æ—¥æœŸæ™‚é—œé–‰æ–°å¢
                        renderItinerary();
                    }
                });
            });
        }

        // --- æ¸²æŸ“å‡½æ•¸ï¼šæ¶ˆè²»ç´€éŒ„ (Finance) (ä¿ç•™) ---
        
        function renderFinance() {
            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = `
                <h2 class="text-2xl font-bold text-main-green mb-6 pt-2 flex items-center"><i data-lucide="wallet" class="w-6 h-6 mr-2"></i> æ¶ˆè²»ç´€éŒ„ & æ›åŒ¯</h2>
                <div id="exchange-rate-section">
                    <p class="text-center text-warm-gray py-8">æ­£åœ¨è¼‰å…¥å³æ™‚åŒ¯ç‡...</p>
                </div>
                <div id="expense-record-section">
                    ${renderExpenseSummary()}
                    <h3 class="text-xl font-bold text-gray-800 mt-6 mb-3 border-b border-warm-gray/30 pb-1 flex items-center"><i data-lucide="receipt" class="w-5 h-5 mr-2 text-main-green"></i> æ¯æ—¥é–‹æ”¯</h3>
                    ${renderExpenseList()}
                    ${renderAddExpenseForm()}
                </div>
            `;

            lucide.createIcons();
            fetchExchangeRate().then(renderExchangeRate);
            document.getElementById('add-expense-form')?.addEventListener('submit', handleAddExpense);
        }

        function renderExchangeRate() {
            const { baseCurrency, targetCurrency, rate, lastUpdated, exchangeStatus } = financeState;
            const rateSection = document.getElementById('exchange-rate-section');
            rateSection.innerHTML = `
                <div class="bg-accent-gold/20 p-4 rounded-2xl shadow-md border border-accent-gold/50">
                    <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center justify-between">
                        <span class="flex items-center"><i data-lucide="rotate-cw" class="w-5 h-5 mr-2 text-main-green"></i> å³æ™‚å°æ›ç‡</span>
                        <span class="text-xs text-warm-gray">ç‹€æ…‹: ${exchangeStatus}</span>
                    </h3>
                    <div class="text-center bg-snow-white p-3 rounded-xl">
                        <p class="text-3xl font-extrabold text-accent-shop">1 ${baseCurrency} = ${rate} ${targetCurrency}</p>
                    </div>
                    <p class="text-xs text-warm-gray mt-2 text-right">æœ€å¾Œæ›´æ–°: ${lastUpdated}</p>
                </div>
            `;
            lucide.createIcons();
        }

        function calculateExpenseSummary() {
            const totalHKD = financeState.expenses.reduce((sum, exp) => sum + exp.amountHKD, 0);
            const remaining = financeState.budget - totalHKD;
            return { totalHKD, remaining };
        }

        function renderExpenseSummary() {
            const { totalHKD, remaining } = calculateExpenseSummary();
            const remainingColor = remaining >= 0 ? 'text-main-green' : 'text-main-red';
            const remainingText = remaining >= 0 ? 'å‰©é¤˜é ç®—' : 'å·²è¶…æ”¯';

            return `
                <div class="bg-main-green/10 p-4 rounded-2xl shadow-inner grid grid-cols-2 gap-4 text-center">
                    <div>
                        <p class="text-sm text-gray-600 font-medium">ç¸½é ç®— (HKD)</p>
                        <p class="text-xl font-extrabold text-main-green mt-1">$${financeState.budget.toFixed(1)}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 font-medium">ç¸½èŠ±è²» (HKD)</p>
                        <p class="text-xl font-extrabold text-main-red mt-1">$${totalHKD.toFixed(1)}</p>
                    </div>
                    <div class="col-span-2 mt-2 pt-2 border-t border-main-green/20">
                        <p class="text-base font-bold ${remainingColor}">${remainingText} ($${Math.abs(remaining).toFixed(1)})</p>
                    </div>
                </div>
            `;
        }

        function renderExpenseList() {
            if (financeState.expenses.length === 0) {
                return '<p class="text-center text-warm-gray mt-4">å°šæœªç´€éŒ„ä»»ä½•æ¶ˆè²»ã€‚</p>';
            }

            return `
                <div class="space-y-2 max-h-60 overflow-y-auto">
                    ${financeState.expenses.map(exp => `
                        <div class="flex justify-between items-center bg-main-red/10 p-3 rounded-xl border border-main-red/20">
                            <div>
                                <p class="text-sm font-semibold text-gray-800">${exp.item}</p>
                                <p class="text-xs text-warm-gray">Day ${exp.day} | ${exp.category}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-base font-bold text-main-red">â‚©${exp.amountKRW.toLocaleString()}</p>
                                <p class="text-xs text-gray-600">$${exp.amountHKD.toFixed(1)}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function renderAddExpenseForm() {
            return `
                <h3 class="text-xl font-bold text-gray-800 mt-6 mb-3 border-b border-warm-gray/30 pb-1 flex items-center"><i data-lucide="plus-circle" class="w-5 h-5 mr-2 text-main-green"></i> æ–°å¢ç´€éŒ„</h3>
                <form id="add-expense-form" class="space-y-3 bg-accent-sight/20 p-4 rounded-xl border border-accent-sight/30">
                    <div>
                        <label class="text-xs font-semibold text-gray-700 block mb-1">é …ç›®æè¿°</label>
                        <input type="text" id="expense-item" required class="w-full p-2 border rounded-lg">
                    </div>
                    <div class="flex space-x-3">
                        <div class="w-1/2">
                            <label class="text-xs font-semibold text-gray-700 block mb-1">éŸ“åœœé‡‘é¡ (KRW)</label>
                            <input type="number" step="100" id="amount-krw" required class="w-full p-2 border rounded-lg">
                        </div>
                        <div class="w-1/2">
                            <label class="text-xs font-semibold text-gray-700 block mb-1">åˆ†é¡</label>
                            <select id="expense-category" class="w-full p-2 border rounded-lg">
                                <option value="é¤é£²">é¤é£²</option>
                                <option value="è³¼ç‰©">è³¼ç‰©</option>
                                <option value="äº¤é€š">äº¤é€š</option>
                                <option value="æ´»å‹•">æ´»å‹•</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-main-green text-snow-white p-3 rounded-xl font-bold hover:bg-main-green/90 transition-colors shadow-md">
                        ç¢ºèªæ–°å¢
                    </button>
                    <p id="finance-error" class="text-xs text-main-red text-center mt-2"></p>
                </form>
            `;
        }

        function handleAddExpense(event) {
            event.preventDefault();
            const item = document.getElementById('expense-item').value;
            const amountKRW = parseFloat(document.getElementById('amount-krw').value);
            const category = document.getElementById('expense-category').value;
            const errorElement = document.getElementById('finance-error');
            errorElement.textContent = '';

            if (!item || isNaN(amountKRW) || amountKRW <= 0) {
                errorElement.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®æè¿°å’ŒéŸ“åœœé‡‘é¡ã€‚';
                return;
            }

            const rate = financeState.rate;
            const amountHKD = amountKRW / rate;

            const newExpense = {
                id: Date.now(),
                day: currentDayIndex + 1,
                item,
                amountKRW: parseFloat(amountKRW.toFixed(0)),
                amountHKD: parseFloat(amountHKD.toFixed(1)),
                category
            };

            financeState.expenses.push(newExpense);
            document.getElementById('expense-item').value = '';
            document.getElementById('amount-krw').value = '';
            
            const listContainer = document.querySelector('.space-y-2.max-h-60');
            if (listContainer) {
                document.getElementById('expense-record-section').querySelector('div:first-child').innerHTML = renderExpenseSummary();
                listContainer.innerHTML = renderExpenseList();
                listContainer.scrollTop = listContainer.scrollHeight;
                lucide.createIcons();
            }
        }


        // --- æ¸²æŸ“å‡½æ•¸ï¼šæŒ‡å— (Guide) (ä¿ç•™) ---

        function renderGuide() {
            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = `
                <h2 class="text-2xl font-bold text-main-green mb-6 pt-2 flex items-center"><i data-lucide="map" class="w-6 h-6 mr-2"></i> æ—…éŠæŒ‡å— & èˆªç­</h2>
                
                <h3 class="text-xl font-bold text-gray-800 mb-3 border-b border-warm-gray/30 pb-1 flex items-center"><i data-lucide="plane" class="w-5 h-5 mr-2 text-main-green"></i> èˆªç­ç‹€æ³è¿½è¹¤</h3>
                <div id="flight-status-section" class="space-y-3">
                    <div class="text-center py-8 bg-accent-gold/20 rounded-xl">
                        <i data-lucide="loader-2" class="w-6 h-6 mx-auto animate-spin text-main-green"></i>
                        <p class="text-sm text-gray-700 mt-2">æ­£åœ¨æŸ¥è©¢æœ€æ–°èˆªç­ç‹€æ…‹...</p>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-gray-800 mt-8 mb-3 border-b border-warm-gray/30 pb-1 flex items-center"><i data-lucide="book-open-text" class="w-5 h-5 mr-2 text-main-green"></i> å¯¦ç”¨è³‡è¨Š</h3>
                <div class="space-y-4">
                    <div class="p-4 bg-accent-sight/20 rounded-xl shadow-md border border-accent-sight/30">
                        <h4 class="text-lg font-bold text-main-green mb-2">äº¤é€šå¡èˆ‡æ›åŒ¯</h4>
                        <p class="text-sm text-gray-700">å»ºè­°åœ¨æ©Ÿå ´è³¼è²· T-Money å¡ï¼Œä¸¦åœ¨æ˜æ´æ›åŒ¯æ‰€æ›å–æ›´å„ªæƒ åŒ¯ç‡ã€‚åœ°éµå…¬è»Šéƒ½é©ç”¨ã€‚</p>
                    </div>
                    <div class="p-4 bg-accent-sight/20 rounded-xl shadow-md border border-accent-sight/30">
                        <h4 class="text-lg font-bold text-main-green mb-2">ç¶²è·¯èˆ‡é€šè¨Š</h4>
                        <p class="text-sm text-gray-700">å»ºè­°ä½¿ç”¨ SIM å¡æˆ–ç§Ÿç”¨ Wi-Fi æ©Ÿã€‚éŸ“åœ‹å°èˆªè«‹å‹™å¿…æ­é… Naver Map / Kakao Map ä½¿ç”¨ã€‚</p>
                    </div>
                </div>
            `;
            lucide.createIcons();
            
            fetchFlightStatus().then(flights => {
                const flightHtml = flights.map(flight => `
                    <div class="flex items-center bg-snow-white p-4 rounded-xl shadow-sm border-l-4 ${flight.code === 'UO626' ? 'border-main-green' : 'border-main-red'}">
                        <i data-lucide="${flight.icon}" class="w-8 h-8 mr-4 ${flight.color}"></i>
                        <div class="flex-grow">
                            <p class="text-sm font-bold text-gray-800">${flight.code} (${flight.status})</p>
                            <p class="text-xs text-warm-gray">${flight.route}</p>
                            <p class="text-xs font-semibold text-gray-600 mt-1">é è¨ˆ: ${flight.scheduled} â†’ å¯¦éš›: ${flight.estimated}</p>
                        </div>
                    </div>
                `).join('');
                document.getElementById('flight-status-section').innerHTML = flightHtml;
                lucide.createIcons();
            });
        }


        // --- æ¸²æŸ“å‡½æ•¸ï¼šå¤©æ°£ (Weather) (ä¿ç•™) ---

        function renderWeather() {
             const contentDiv = document.getElementById('app-content');
             const title = 'â˜ï¸ é¦–çˆ¾äº”æ—¥å¤©æ°£';
             const contentHtml = `
                <div class="text-center p-6 bg-main-red/10 rounded-2xl border border-main-red/20 mb-4">
                    <p class="text-xl font-bold text-main-green">12/25 - 12/29</p>
                    <p class="text-4xl my-3 text-main-green">å¹³å‡æ°£æº« -5Â°C ~ 3Â°C</p>
                    <p class="text-sm text-gray-700">å¤šé›²/æ™´ï¼Œæ—¥å¤œæº«å·®å¤§ã€‚è«‹å‹™å¿…æ”œå¸¶è¶³å¤ ä¿æš–è¡£ç‰©ã€‚</p>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    ${[25, 26, 27, 28, 29].map(d => `
                        <div class="p-4 bg-snow-white rounded-xl shadow-sm border border-warm-gray/30 text-center">
                            <p class="font-bold text-lg text-gray-800">12/${d}</p>
                            <p class="text-3xl my-2">
                                ${d % 2 === 0 ? '<i data-lucide="cloud" class="w-8 h-8 mx-auto text-main-green"></i>' : '<i data-lucide="sun" class="w-8 h-8 mx-auto text-accent-gold"></i>'}
                            </p>
                            <p class="text-sm text-gray-600">ä½: -7Â°C / é«˜: 1Â°C</p>
                        </div>
                    `).join('')}
                </div>
            `;
            contentDiv.innerHTML = `
                <h2 class="text-2xl font-bold text-main-green mb-6 pt-2">${title}</h2>
                ${contentHtml}
            `;
            lucide.createIcons();
        }


        // --- é€šç”¨ Tab åˆ‡æ›é‚è¼¯ ---

        function renderTabContent(tabName) {
            document.getElementById('app-content').innerHTML = '';

            // é‡ç½®è¡Œç¨‹ç·¨è¼¯/æ–°å¢ç‹€æ…‹
            editingSpotId = null;
            isAddingSpot = false;

            if (tabName === 'itinerary') {
                renderItinerary();
            } else if (tabName === 'guide') {
                renderGuide();
            } else if (tabName === 'weather') {
                renderWeather();
            } else if (tabName === 'finance') {
                renderFinance();
            }
        }

        /**
         * å°è¦½åˆ—åˆ‡æ›é‚è¼¯
         */
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                const tabName = e.currentTarget.dataset.tab;
                
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('nav-active'));
                
                e.currentTarget.classList.add('nav-active');
                
                renderTabContent(tabName);
            });
        });

        // é é¢åŠ è¼‰å®Œæˆå¾Œï¼Œåˆå§‹åŒ–ä¸¦æ¸²æŸ“è¡Œç¨‹é é¢
        window.onload = function() {
            // å°‡ CRUD å‡½æ•¸æš´éœ²åˆ°å…¨å±€ï¼Œä»¥ä¾¿åœ¨ HTML å…§è¯äº‹ä»¶ä¸­ä½¿ç”¨
            window.startEdit = startEdit;
            window.cancelEdit = cancelEdit;
            window.handleSaveSpot = handleSaveSpot;
            window.handleDeleteSpot = handleDeleteSpot;
            window.isAddingSpot = isAddingSpot; // æš´éœ²ç‹€æ…‹
            window.renderItinerary = renderItinerary; // æš´éœ²æ¸²æŸ“å‡½æ•¸

            renderItinerary();
        }

    </script>
</body>
</html>

